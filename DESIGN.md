# YamlGuardian Design Document

## 1. システムの目的
YamlGuardianは、YAMLファイルに基づいてデータの検証を行うツールです。このシステムは、特にフォームの検証や設定の管理を行う際に、定義されたルールに従ってデータが正しいかどうかを確認するために使用されます。これにより、データの整合性や正確性を保証し、エラーの早期発見を促します。

## 2. 機能
### 主な機能
#### YAMLファイルの読み込み
スキーマファイル、関係ファイル、共通定義ファイルを読み込み、データを構造化する。

#### データ検証
指定されたデータがYAMLスキーマに基づいて正しいかどうかを検証する。
必須フィールドが欠けている場合や、ルールに違反している場合にエラーメッセージを返す。

#### ルールの適用
各ルールに基づいて、条件に従った適切な検証を行う。

### 追加機能
- 検証結果のログ出力
- エラーの詳細なトレース
- CLIインターフェースの提供

## 3. アーキテクチャ
### 3.1 モジュール構成
- `core.py`: YamlGuardianのコア機能を提供し、YAMLファイルの読み込みとデータ検証を管理する。
- `validator.py`: YAMLのルールに基づいてデータを検証するためのモジュール。
- `rules.py`: ルールを管理し、検証を行うためのモジュール。
- `utils.py`: ユーティリティ関数を含むモジュール。例えば、フィールドの存在確認など。

### 3.2 データ構造
#### スキーマ構造
```yaml
root_element:
  - name: "FormA"
    type: "form"
    description: "このフォームはラベルとラジオボタンの関係を定義します。"
    attributes:
      action: "/submit"
      method: "post"
    elements:
      - name: AAA
        type: label
        required: true
        ...
```

#### 関係構造
```yaml
root_element_relations:
  - source: "FormA"
    target: "FormB"
    condition: "exists"
```

#### 共通要素構造
```yaml
common_elements:
  - name: commonLabel
    type: label
    required: true
    ...
```

## 4. データフロー
### YAMLファイルの読み込み
ユーザーはYamlGuardianにスキーマファイル、関係ファイル、共通定義ファイルのパスを提供します。
YamlGuardianはこれらのファイルを読み込み、データ構造を作成します。

### データ検証
ユーザーは検証したいデータを提供します。
YamlGuardianは、読み込んだスキーマと関係に基づいてデータを検証します。

### エラー報告
検証結果がエラーであれば、エラーメッセージを生成し、ユーザーに返します。

## 5. エラーハンドリング
### 必須フィールドエラー
必須フィールドが欠けている場合、"フィールド名が存在しません。"というメッセージを返します。

### 禁止フィールドエラー
禁止されているフィールドが存在する場合、"フィールド名は選択できません。"というメッセージを返します。

### YAML読み込みエラー
YAMLファイルの読み込みに失敗した場合、適切なエラーメッセージを表示します。

## 6. 拡張性
### 新しいルールの追加
ルールに関する新しい機能を追加することが容易であり、rules.pyに新しい検証ロジックを組み込むことで拡張できます。

### 新しいYAMLフォーマットのサポート
追加のYAMLフォーマットをサポートするために、読み込み機能を拡張することが可能です。

## 7. 今後の展望
### GUIインターフェースの追加
ユーザーがより直感的にデータを検証できるように、GUIを開発することを検討します。

### CI/CD統合
自動化されたテストと統合を行うことで、データの整合性を継続的にチェックできるようにします。

この設計文書は、YamlGuardianの全体的な構造と機能を明確に示しています。この文書を基に、開発を進めることができます。必要に応じて、さらなる詳細や仕様を追加することが可能です。
